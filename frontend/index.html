<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoDetail.az</title>
  <link href="style.css?v=4" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>

<body class="d-flex flex-column min-vh-100">
  <header class="p-3 text-bg-dark">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start"> <a href="/"
          class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none"> <svg class="bi me-2"
            width="40" height="32" role="img" aria-label="Bootstrap">
            <use xlink:href="#bootstrap"></use>
          </svg> </a>
        <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
          <li class="maÅŸÄ±n-logo"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
              class="bi bi-car-front-fill" viewBox="0 0 16 16">
              <path
                d="M2.52 3.515A2.5 2.5 0 0 1 4.82 2h6.362c1 0 1.904.596 2.298 1.515l.792 1.848c.075.175.21.319.38.404.5.25.855.715.965 1.262l.335 1.679q.05.242.049.49v.413c0 .814-.39 1.543-1 1.997V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.338c-1.292.048-2.745.088-4 .088s-2.708-.04-4-.088V13.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-1.892c-.61-.454-1-1.183-1-1.997v-.413a2.5 2.5 0 0 1 .049-.49l.335-1.68c.11-.546.465-1.012.964-1.261a.8.8 0 0 0 .381-.404l.792-1.848ZM3 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2m10 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6 8a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2zM2.906 5.189a.51.51 0 0 0 .497.731c.91-.073 3.35-.17 4.597-.17s3.688.097 4.597.17a.51.51 0 0 0 .497-.731l-.956-1.913A.5.5 0 0 0 11.691 3H4.309a.5.5 0 0 0-.447.276L2.906 5.19Z" />
            </svg></li>
          <li><a href="./index.html" class="nav-link px-2 text-secondary" data-i18n="nav_home">Home</a></li>
          <li><a href="./profile.html" class="nav-link px-2 text-white" data-i18n="nav_profile">Profil</a></li>
          <li><a href="./about.html" class="nav-link px-2 text-white" data-i18n="nav_about">About</a></li>
          <li><a href="./favorites.html" class="nav-link px-2 text-white favorites-only d-none">SevimlilÉ™rim</a></li>
          <li><a href="./admin.html" class="nav-link px-2 text-white admin-only d-none">Admin</a></li>
        </ul>
        <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search">
          <div class="suggest-wrap">
            <input id="header-search" type="search" class="form-control form-control-dark text-bg-dark" placeholder="search.."
              aria-label="Search">
            <div id="header-suggest" class="suggest-dropdown d-none"></div>
          </div>
        </form>
        <div class="language-switcher ms-lg-2 me-lg-3">
          <button type="button" class="btn btn-outline-light btn-sm lang-btn" data-lang="az">ğŸ‡¦ğŸ‡¿</button>
          <button type="button" class="btn btn-outline-light btn-sm lang-btn" data-lang="en">ğŸ‡¬ğŸ‡§</button>
          <button type="button" class="btn btn-outline-light btn-sm lang-btn" data-lang="ru">ğŸ‡·ğŸ‡º</button>
        </div>
        <div class="add-post-center">
          <button id="add-post-btn" type="button" class="btn btn-warning btn-sm">+</button>
        </div>
        <div class="text-end">
          <div id="auth-guest" class="d-inline">
            <a href="./register.html" class="btn btn-outline-light me-2" data-i18n="btn_register">Qeydiyyat</a>
            <a href="./login.html" class="btn btn-warning" data-i18n="btn_login">Daxil ol</a>
          </div>
          <div id="auth-user" class="d-none align-items-center gap-2">
            <a href="./profile.html" class="text-white text-decoration-none" aria-label="Profil">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor"
                class="bi bi-person-circle" viewBox="0 0 16 16">
                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                <path fill-rule="evenodd"
                  d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37c.69-1.19 1.77-2.27 3.24-2.27h4.457c1.47 0 2.55 1.08 3.24 2.27A7 7 0 0 0 8 1" />
              </svg>
            </a>
            <button id="logout-btn" type="button" class="btn btn-outline-light btn-sm" data-i18n="btn_logout">Log out</button>
          </div>
        </div>
      </div>
    </div>
  </header>
  <hr class="border-light border-2 opacity-75 my-0">
  <div class="container my-3 filter-bar">
    <div class="row g-2">
      <div class="col-md-3">
        <div class="suggest-wrap">
          <input id="filter-brand" class="form-control" placeholder="Brand">
          <div id="filter-brand-suggest" class="suggest-dropdown d-none"></div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="suggest-wrap">
          <input id="filter-model" class="form-control" placeholder="Model">
          <div id="filter-model-suggest" class="suggest-dropdown d-none"></div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="suggest-wrap">
          <input id="filter-year" class="form-control" placeholder="Year">
          <div id="filter-year-suggest" class="suggest-dropdown d-none"></div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="suggest-wrap">
          <input id="filter-color" class="form-control" placeholder="Color">
          <div id="filter-color-suggest" class="suggest-dropdown d-none"></div>
        </div>
      </div>
      <div class="col-md-2"><button id="filter-clear" class="btn btn-warning w-100">Clear</button></div>
    </div>
    <div class="row g-2 mt-3">
      <div class="col-md-10">
        <input id="filter-part" class="form-control" list="part-suggestions" placeholder="Ehtiyat hissÉ™si">
        <datalist id="part-suggestions"></datalist>
      </div>
      <div class="col-md-2"><button id="filter-part-clear" class="btn btn-warning w-100">Clear</button></div>
    </div>
  </div>
  <div class="container my-5 flex-grow-1">
    <div class="row p-4 pb-0 pe-lg-0 pt-lg-5 align-items-center rounded-3 border shadow-lg">
      <div class="col-lg-7 p-3 p-lg-5 pt-lg-3">
        <h1 class="display-4 fw-bold lh-1 text-body-emphasis" data-i18n="hero_title">MaÅŸÄ±nÄ±nÄ±z Ã¼Ã§Ã¼n bÃ¼tÃ¼n detallar bir saytda.</h1>
        <p class="lead" data-i18n="hero_lead">ArtÄ±q uzun yollar qÉ™t edib maÅŸÄ±nÄ±nz Ã¼Ã§Ã¼n ideal detal axtarmaÄŸÄ±nÄ±za ehtiyac yoxdur.ElÉ™ indi
          sadÉ™cÉ™ AutoDetail.az saytÄ±na daxil olun vÉ™ istÉ™diyiniz detalÄ±,ustanÄ± mÃ¼ÅŸtÉ™ri rÉ™ylÉ™ri ilÉ™ qiymÉ™tlÉ™ndirin vÉ™
          kÃ¶nÃ¼l rahatlÄ±qÄ± ilÉ™ alÄ±ÅŸ-veriÅŸ edin.</p>
        <div class="d-grid gap-2 d-md-flex justify-content-md-start mb-4 mb-lg-3">
          <a href="./login.html" class="btn btn-primary btn-lg px-4 me-md-2 fw-bold" data-i18n="hero_login">Daxil ol</a>
          <a href="./register.html" class="btn btn-outline-secondary btn-lg px-4" data-i18n="hero_register">Qeydiyyat</a>
        </div>
      </div>
      <div class="col-lg-4 offset-lg-1 p-0 overflow-hidden shadow-lg changan_car"> <img
          src="./assets/images/ChatGPT Image Feb 4, 2026, 09_40_20 PM.png"
          class="img-fluid w-100 h-100 object-fit-cover" alt="changan_car_[hoto]"> </div>
    </div>
  </div>
  <div class="container sekilo mb-10 flex-grow-1">
    <div id="posts-grid" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"></div>
  </div>

  <hr class="border-light border-2 opacity-75 my-0">
  <footer class="bg-dark text-white py-3 mt-auto">
    <div class="container">

            <div class="footer-contact mb-3">
        <div class="footer-contact-label">ÆlaqÉ™ Ã¼Ã§Ã¼n:</div>
        <div class="footer-contact-row">
          <input class="footer-contact-input form-control form-control-dark text-bg-dark" placeholder="Emailinizi yazÄ±n">
          <input class="footer-contact-message form-control form-control-dark text-bg-dark" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n">
          <button class="footer-contact-send btn btn-warning">GÃ¶ndÉ™r</button>
        </div>
      </div>

      <ul class="nav justify-content-center border-bottom pb-3 mb-3">
        <li class="nav-item"><a href="./index.html" class="nav-link px-2 text-white" data-i18n="nav_home">Home</a></li>
        <li class="nav-item"><a href="./profile.html" class="nav-link px-2 text-white" data-i18n="nav_profile">Profil</a></li>
        <li class="nav-item"><a href="./about.html" class="nav-link px-2 text-white" data-i18n="nav_about">About</a></li>
      </ul>

      <p class="text-center mb-0">Â© 2026 AutoDetail.az</p>

    </div>
  </footer>


  <script>
    const translations = {
      az: {
        nav_home: 'Ana sÉ™hifÉ™',
        nav_contact: 'ÆlaqÉ™',
        nav_details: 'Detallar',
        nav_profile: 'Profil',
        nav_about: 'HaqqÄ±mÄ±zda',
        btn_register: 'Qeydiyyat',
        btn_login: 'Daxil ol',
        btn_logout: 'Ã‡Ä±xÄ±ÅŸ',
        hero_title: 'MaÅŸÄ±nÄ±nÄ±z Ã¼Ã§Ã¼n bÃ¼tÃ¼n detallar bir saytda.',
        hero_lead: 'ArtÄ±q uzun yollar qÉ™t edib maÅŸÄ±nÄ±nz Ã¼Ã§Ã¼n ideal detal axtarmaÄŸÄ±nÄ±za ehtiyac yoxdur.ElÉ™ indi sadÉ™cÉ™ AutoDetail.az saytÄ±na daxil olun vÉ™ istÉ™diyiniz detalÄ±,ustanÄ± mÃ¼ÅŸtÉ™ri rÉ™ylÉ™ri ilÉ™ qiymÉ™tlÉ™ndirin vÉ™ kÃ¶nÃ¼l rahatlÄ±qÄ± ilÉ™ alÄ±ÅŸ-veriÅŸ edin.',
        hero_login: 'Daxil ol',
        hero_register: 'Qeydiyyat',
        card_text: 'Bu kartda É™lavÉ™ mÉ™lumatlar Ã¼Ã§Ã¼n qÄ±sa tÉ™svir yerlÉ™ÅŸir. MÉ™zmun bir qÉ™dÉ™r uzundur.',
        btn_view: 'Bax',
        btn_edit: 'RedaktÉ™',
        thumb: 'MiniatÃ¼r',
        msg_liked: 'BÉ™yÉ™nildi',
        msg_unliked: 'BÉ™yÉ™nmÉ™ lÉ™ÄŸv edildi',
        search_frames: ['Axtar', 'Axtar.', 'Axtar..', 'Axtar...']
      },
      en: {
        nav_home: 'Home',
        nav_contact: 'Contact',
        nav_details: 'Details',
        nav_profile: 'Profile',
        nav_about: 'About',
        btn_register: 'Register',
        btn_login: 'Log in',
        btn_logout: 'Log out',
        hero_title: 'All details for your car in one place.',
        hero_lead: 'No more long trips to find the perfect part for your car. Enter AutoDetail.az now, review parts and services with customer feedback, and shop with confidence.',
        hero_login: 'Log in',
        hero_register: 'Register',
        card_text: 'This card includes short supporting text below as a natural lead-in to additional content.',
        btn_view: 'View',
        btn_edit: 'Edit',
        thumb: 'Thumbnail',
        msg_liked: 'Liked',
        msg_unliked: 'Unliked',
        search_frames: ['Search', 'Search.', 'Search..', 'Search...']
      },
      ru: {
        nav_home: 'Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ',
        nav_contact: 'ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚',
        nav_details: 'Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸',
        nav_profile: 'ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ',
        nav_about: 'Ğ Ğ½Ğ°Ñ',
        btn_register: 'Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ',
        btn_login: 'Ğ’Ğ¾Ğ¹Ñ‚Ğ¸',
        btn_logout: 'Ğ’Ñ‹Ğ¹Ñ‚Ğ¸',
        hero_title: 'Ğ’ÑĞµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ´Ğ»Ñ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»Ñ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ.',
        hero_lead: 'Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ ĞµĞ·Ğ´Ğ¸Ñ‚ÑŒ Ğ² Ğ¿Ğ¾Ğ¸ÑĞºĞ°Ñ… Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸. Ğ—Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚Ğµ Ğ½Ğ° AutoDetail.az, Ğ¾Ñ†ĞµĞ½Ğ¸Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¿Ğ¾ Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ°Ğ¼ Ğ¸ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ğ¹Ñ‚Ğµ Ñ ÑƒĞ²ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒÑ.',
        hero_login: 'Ğ’Ğ¾Ğ¹Ñ‚Ğ¸',
        hero_register: 'Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ',
        card_text: 'Ğ­Ñ‚Ğ° ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ° ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ñ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸ĞµĞ¼ Ğ¸ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹.',
        btn_view: 'ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€',
        btn_edit: 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ',
        thumb: 'ĞœĞ¸Ğ½Ğ¸Ğ°Ñ‚ÑÑ€Ğ°',
        msg_liked: 'ĞŸĞ¾Ğ½Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ¾ÑÑŒ',
        msg_unliked: 'Ğ£Ğ±Ñ€Ğ°Ğ½Ğ¾ Ğ¸Ğ· Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾',
        search_frames: ['ĞŸĞ¾Ğ¸ÑĞº', 'ĞŸĞ¾Ğ¸ÑĞº.', 'ĞŸĞ¾Ğ¸ÑĞº..', 'ĞŸĞ¾Ğ¸ÑĞº...']
      }
    };

    let currentLang = localStorage.getItem('siteLang') || 'az';

    const applyTranslations = () => {
      const dict = translations[currentLang] || translations.az;
      document.documentElement.lang = currentLang;
      document.querySelectorAll('[data-i18n]').forEach((el) => {
        const key = el.getAttribute('data-i18n');
        if (dict[key]) {
          el.textContent = dict[key];
        }
      });
      startSearchAnimation(dict.search_frames || translations.az.search_frames);
    };

    let searchTimer;
    const startSearchAnimation = (frames) => {
      const searchInput = document.querySelector('input[type="search"]');
      if (!searchInput) {
        return;
      }
      if (searchTimer) {
        clearInterval(searchTimer);
      }
      let i = 0;
      searchTimer = setInterval(() => {
        searchInput.setAttribute('placeholder', frames[i % frames.length]);
        i += 1;
      }, 500);
    };

    document.querySelectorAll('.lang-btn').forEach((btn) => {
      btn.addEventListener('click', () => {
        currentLang = btn.dataset.lang;
        localStorage.setItem('siteLang', currentLang);
        applyTranslations();
      });
    });

    const addPostBtn = document.getElementById('add-post-btn');
    if (addPostBtn) {
      addPostBtn.addEventListener('click', () => {
        const currentUser = localStorage.getItem('currentUser');
        if (!currentUser) {
          window.location.href = './login.html';
          return;
        }
        window.location.href = './add-post.html';
      });
    }

    const postsGrid = document.getElementById('posts-grid');
    const headerSearch = document.getElementById('header-search');
    const headerSuggest = document.getElementById('header-suggest');
    const filterBrand = document.getElementById('filter-brand');
    const filterBrandSuggest = document.getElementById('filter-brand-suggest');
    const filterModel = document.getElementById('filter-model');
    const filterModelSuggest = document.getElementById('filter-model-suggest');
    const filterYear = document.getElementById('filter-year');
    const filterYearSuggest = document.getElementById('filter-year-suggest');
    const filterColor = document.getElementById('filter-color');
    const filterColorSuggest = document.getElementById('filter-color-suggest');
    const filterClear = document.getElementById('filter-clear');
    const filterPart = document.getElementById('filter-part');
    const filterPartClear = document.getElementById('filter-part-clear');
    const partSuggestions = document.getElementById('part-suggestions');
    let postsCache = [];
    let favoriteIds = new Set();
    let brandOptions = [];
    let modelOptions = [];
    let searchOptions = [];
    let yearOptions = [];
    let colorOptions = [];
    let modelsData = [];

    const renderSuggest = (box, items) => {
      if (!box) return;
      if (!items.length) {
        box.classList.add('d-none');
        box.innerHTML = '';
        return;
      }
      box.innerHTML = items.map((item) => `<button type="button" class="suggest-item">${item}</button>`).join('');
      box.classList.remove('d-none');
    };

    const renderPosts = (posts) => {
      if (!postsGrid) return;
      const dict = translations[currentLang] || translations.az;
      if (!posts || posts.length === 0) {
        postsGrid.innerHTML = '<div class="col-12 text-body-secondary">HÉ™lÉ™ paylaÅŸÄ±m yoxdur.</div>';
        return;
      }
      postsGrid.innerHTML = posts
        .map((post) => {
          const image = post.image_url
            ? `<img src="${post.image_url}" class="card-img-top" alt="PaylaÅŸÄ±m">`
            : '';
          const liked = favoriteIds.has(post.id);
          return `
            <div class="col">
              <div class="card shadow-sm h-100 position-relative" style="cursor:pointer" onclick="if(event.target.closest('.card-like-btn')){return;} window.location.href='./post.html?id=${post.id}'">
                <button class="card-like-btn ${liked ? 'liked' : ''}" data-like-id="${post.id}" title="Like" onclick="event.stopPropagation(); event.preventDefault();">
                  ${liked ? 'â™¥' : 'â™¡'}
                </button>
                <div class="card-like-toast" data-like-toast="${post.id}"></div>
                ${image}
                <div class="card-body">
                  <h3 class="h6 mb-1">${post.title || 'PaylaÅŸÄ±m'}</h3>
                  <p class="text-body-secondary mb-2">${post.part_type || ''}</p>
                  <p class="mb-2 fw-semibold">${post.price !== null && post.price !== undefined ? `${post.price} ${post.price_currency || ''}`.trim() : ''}</p>
                  <p class="mb-0">${post.car_brand || ''} ${post.car_model || ''} ${post.car_year || ''} ${post.car_color || ''}</p>
                </div>
              </div>
            </div>
          `;
        })
        .join('');
    };
    const showLikeToast = (btn, message) => {
      if (!btn) return;
      const card = btn.closest('.card');
      if (!card) return;
      const toast = card.querySelector(`.card-like-toast[data-like-toast="${btn.dataset.likeId}"]`);
      if (!toast) return;
      toast.textContent = message;
      toast.classList.add('show');
      clearTimeout(toast.timer);
      toast.timer = setTimeout(() => {
        toast.classList.remove('show');
      }, 1200);
    };

    const applyFilters = () => {
      const q = (headerSearch?.value || '').trim().toLowerCase();
      const b = (filterBrand?.value || '').trim().toLowerCase();
      const m = (filterModel?.value || '').trim().toLowerCase();
      const y = (filterYear?.value || '').trim().toLowerCase();
      const c = (filterColor?.value || '').trim().toLowerCase();
      const p = (filterPart?.value || '').trim().toLowerCase();
      let list = postsCache.slice();
      if (q) {
        list = list.filter((p) =>
          `${p.title || ''} ${p.part_type || ''} ${p.car_brand || ''} ${p.car_model || ''} ${p.car_year || ''} ${p.car_color || ''}`
            .toLowerCase()
            .includes(q)
        );
      }
      if (b) list = list.filter((p) => String(p.car_brand || '').toLowerCase().includes(b));
      if (m) list = list.filter((p) => String(p.car_model || '').toLowerCase().includes(m));
      if (y) list = list.filter((p) => String(p.car_year || '').toLowerCase().includes(y));
      if (c) list = list.filter((p) => String(p.car_color || '').toLowerCase().includes(c));
      if (p) list = list.filter((p) => String(p.part_type || '').toLowerCase().includes(p));
      renderPosts(list);
    };

    const loadFavorites = async () => {
      const currentUserRaw = localStorage.getItem('currentUser');
      if (!currentUserRaw) return;
      const email = JSON.parse(currentUserRaw).email;
      try {
        const data = await fetch(`/api/favorites?email=${encodeURIComponent(email)}`).then(r => r.json());
        favoriteIds = new Set((data.favorites || []).map((f) => f.id));
      } catch {}
    };

    fetch('/api/posts')
      .then((res) => res.json())
      .then((data) => {
        postsCache = data.posts || [];
        loadFavorites().finally(() => renderPosts(postsCache));
        if (partSuggestions) {
          const parts = Array.from(new Set(postsCache.map((p) => p.part_type).filter(Boolean)));
          partSuggestions.innerHTML = parts.map((p) => `<option value="${p}"></option>`).join('');
        }
        searchOptions = Array.from(new Set(
          postsCache.flatMap((p) => [
            p.title,
            p.part_type,
            p.car_brand,
            p.car_model
          ]).filter(Boolean)
        ));
      })
      .catch(() => {
        if (postsGrid) {
          postsGrid.innerHTML = '<div class="col-12 text-danger">PaylaÅŸÄ±mlarÄ± yÃ¼klÉ™mÉ™k olmadÄ±.</div>';
        }
      });

    fetch('/api/cars/models')
      .then((res) => res.json())
      .then((data) => {
        modelsData = data.models || [];
        brandOptions = Array.from(new Set(modelsData.map((m) => m.brand).filter(Boolean)));
        modelOptions = Array.from(new Set(modelsData.map((m) => m.model).filter(Boolean)));
      })
      .catch(() => {
        brandOptions = [];
        modelOptions = [];
      });

    fetch('/api/cars')
      .then((res) => res.json())
      .then((data) => {
        const cars = data.cars || [];
        yearOptions = Array.from(new Set(cars.map((c) => c.year).filter(Boolean))).map(String).sort((a, b) => Number(b) - Number(a));
        colorOptions = Array.from(new Set(cars.map((c) => c.color).filter(Boolean)));
      })
      .catch(() => {
        yearOptions = [];
        colorOptions = [];
      });

    if (headerSearch) headerSearch.addEventListener('input', applyFilters);
    [filterBrand, filterModel, filterYear, filterColor, filterPart].forEach((el) => {
      if (el) el.addEventListener('input', applyFilters);
    });

    if (headerSearch && headerSuggest) {
      const updateHeaderSuggest = () => {
        const q = headerSearch.value.trim().toLowerCase();
        if (!q) {
          renderSuggest(headerSuggest, []);
          return;
        }
        const filtered = searchOptions.filter((s) => String(s).toLowerCase().includes(q));
        const items = (filtered.length ? filtered : searchOptions).slice(0, 8);
        renderSuggest(headerSuggest, items);
      };
      headerSearch.addEventListener('input', updateHeaderSuggest);
      headerSearch.addEventListener('focus', updateHeaderSuggest);
    }

    if (filterBrand && filterBrandSuggest) {
      const updateBrandSuggest = () => {
        const q = filterBrand.value.trim().toLowerCase();
        if (!q) {
          renderSuggest(filterBrandSuggest, []);
          return;
        }
        const filtered = brandOptions.filter((s) => String(s).toLowerCase().includes(q));
        const items = (filtered.length ? filtered : brandOptions).slice(0, 8);
        renderSuggest(filterBrandSuggest, items);
      };
      filterBrand.addEventListener('input', updateBrandSuggest);
      filterBrand.addEventListener('focus', updateBrandSuggest);
    }

    if (filterModel && filterModelSuggest) {
      const updateModelSuggest = () => {
        const q = filterModel.value.trim().toLowerCase();
        const brand = (filterBrand?.value || '').trim().toLowerCase();
        const scopedModels = brand
          ? modelsData
              .filter((m) => String(m.brand || '').toLowerCase().includes(brand))
              .map((m) => m.model)
          : modelOptions;
        const uniqModels = Array.from(new Set(scopedModels));
        if (!q) {
          renderSuggest(filterModelSuggest, uniqModels.slice(0, 8));
          return;
        }
        const filtered = uniqModels.filter((s) => String(s).toLowerCase().includes(q));
        const items = (filtered.length ? filtered : uniqModels).slice(0, 8);
        renderSuggest(filterModelSuggest, items);
      };
      filterModel.addEventListener('input', updateModelSuggest);
      filterModel.addEventListener('focus', updateModelSuggest);
      if (filterBrand) {
        filterBrand.addEventListener('input', () => {
          if (document.activeElement === filterModel) {
            updateModelSuggest();
          }
        });
      }
    }

    if (filterYear && filterYearSuggest) {
      const updateYearSuggest = () => {
        const q = filterYear.value.trim().toLowerCase();
        if (!q) {
          renderSuggest(filterYearSuggest, yearOptions.slice(0, 8));
          return;
        }
        const filtered = yearOptions.filter((s) => String(s).toLowerCase().includes(q));
        const items = (filtered.length ? filtered : yearOptions).slice(0, 8);
        renderSuggest(filterYearSuggest, items);
      };
      filterYear.addEventListener('input', updateYearSuggest);
      filterYear.addEventListener('focus', updateYearSuggest);
    }

    if (filterColor && filterColorSuggest) {
      const updateColorSuggest = () => {
        const q = filterColor.value.trim().toLowerCase();
        if (!q) {
          renderSuggest(filterColorSuggest, colorOptions.slice(0, 8));
          return;
        }
        const filtered = colorOptions.filter((s) => String(s).toLowerCase().includes(q));
        const items = (filtered.length ? filtered : colorOptions).slice(0, 8);
        renderSuggest(filterColorSuggest, items);
      };
      filterColor.addEventListener('input', updateColorSuggest);
      filterColor.addEventListener('focus', updateColorSuggest);
    }

    if (headerSuggest) {
      headerSuggest.addEventListener('click', (e) => {
        const btn = e.target.closest('.suggest-item');
        if (!btn) return;
        headerSearch.value = btn.textContent;
        headerSuggest.classList.add('d-none');
        applyFilters();
      });
    }

    if (filterBrandSuggest) {
      filterBrandSuggest.addEventListener('click', (e) => {
        const btn = e.target.closest('.suggest-item');
        if (!btn) return;
        filterBrand.value = btn.textContent;
        filterBrandSuggest.classList.add('d-none');
        applyFilters();
      });
    }

    if (filterModelSuggest) {
      filterModelSuggest.addEventListener('click', (e) => {
        const btn = e.target.closest('.suggest-item');
        if (!btn) return;
        filterModel.value = btn.textContent;
        filterModelSuggest.classList.add('d-none');
        applyFilters();
      });
    }

    if (filterYearSuggest) {
      filterYearSuggest.addEventListener('click', (e) => {
        const btn = e.target.closest('.suggest-item');
        if (!btn) return;
        filterYear.value = btn.textContent;
        filterYearSuggest.classList.add('d-none');
        applyFilters();
      });
    }

    if (filterColorSuggest) {
      filterColorSuggest.addEventListener('click', (e) => {
        const btn = e.target.closest('.suggest-item');
        if (!btn) return;
        filterColor.value = btn.textContent;
        filterColorSuggest.classList.add('d-none');
        applyFilters();
      });
    }

    document.addEventListener('click', (e) => {
      if (headerSuggest && !headerSuggest.contains(e.target) && e.target !== headerSearch) {
        headerSuggest.classList.add('d-none');
      }
      if (filterBrandSuggest && !filterBrandSuggest.contains(e.target) && e.target !== filterBrand) {
        filterBrandSuggest.classList.add('d-none');
      }
      if (filterModelSuggest && !filterModelSuggest.contains(e.target) && e.target !== filterModel) {
        filterModelSuggest.classList.add('d-none');
      }
      if (filterYearSuggest && !filterYearSuggest.contains(e.target) && e.target !== filterYear) {
        filterYearSuggest.classList.add('d-none');
      }
      if (filterColorSuggest && !filterColorSuggest.contains(e.target) && e.target !== filterColor) {
        filterColorSuggest.classList.add('d-none');
      }
    });
    if (filterClear) {
      filterClear.addEventListener('click', () => {
        if (filterBrand) filterBrand.value = '';
        if (filterModel) filterModel.value = '';
        if (filterYear) filterYear.value = '';
        if (filterColor) filterColor.value = '';
        if (headerSearch) headerSearch.value = '';
        if (filterPart) filterPart.value = '';
        renderPosts(postsCache);
      });
    }
    if (filterPartClear) {
      filterPartClear.addEventListener('click', () => {
        if (filterPart) filterPart.value = '';
        renderPosts(postsCache);
      });
    }

    document.addEventListener('click', async (e) => {
      const btn = e.target.closest('.card-like-btn');
      if (!btn) return;
      e.preventDefault();
      e.stopPropagation();
      const postId = Number(btn.dataset.likeId);
      const currentUserRaw = localStorage.getItem('currentUser');
      if (!currentUserRaw) {
        alert('BÉ™yÉ™nmÉ™k Ã¼Ã§Ã¼n daxil olmalÄ±sÄ±nÄ±z.');
        return;
      }
      const email = JSON.parse(currentUserRaw).email;
      try {
        const wasLiked = favoriteIds.has(postId);
        if (wasLiked) {
          await fetch('/api/favorites', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, post_id: postId })
          });
          favoriteIds.delete(postId);
        } else {
          await fetch('/api/favorites', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, post_id: postId })
          });
          favoriteIds.add(postId);
        }
        btn.classList.toggle('liked', !wasLiked);
        btn.textContent = wasLiked ? 'â™¡' : 'â™¥';
        btn.classList.add('like-burst');
        setTimeout(() => btn.classList.remove('like-burst'), 650);
        const dict = translations[currentLang] || translations.az;
        showLikeToast(btn, wasLiked ? dict.msg_unliked : dict.msg_liked);
      } catch {
        const dict = translations[currentLang] || translations.az;
        showLikeToast(btn, dict.msg_error || 'XÉ™ta baÅŸ verdi');
      }
    }, true);

    const guestEl = document.getElementById('auth-guest');
    const userEl = document.getElementById('auth-user');
    const logoutBtn = document.getElementById('logout-btn');
    const currentUser = localStorage.getItem('currentUser');

    if (currentUser) {
      guestEl.classList.add('d-none');
      userEl.classList.remove('d-none');
      userEl.classList.add('d-inline-flex');
    }

    const adminLinks = document.querySelectorAll('.admin-only');
    const favoritesLinks = document.querySelectorAll('.favorites-only');
    if (currentUser) {
      const email = JSON.parse(currentUser).email;
      favoritesLinks.forEach((el) => el.classList.remove('d-none'));
      fetch(`/api/profile?email=${encodeURIComponent(email)}`)
        .then((res) => res.json())
        .then((data) => {
          if (data.user && String(data.user.role).toLowerCase() === 'admin') {
            adminLinks.forEach((el) => el.classList.remove('d-none'));
          }
        })
        .catch(() => {});
    }

    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('currentUser');
        window.location.href = './index.html';
      });
    }

    applyTranslations();

  </script>
  <script src="./assets/contact.js?v=4"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</html>
